<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feedit</title>
    <meta name="description" content="Feedit is a modern, responsive RSS feed reader. Instantly preview, share, and embed the latest articles from your favorite sources.">
    <link rel="canonical" href="https://feedit.madebydanny.uk/">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- Open Graph -->
    <meta property="og:title" content="Feedit - Modern RSS Feed Reader">
    <meta property="og:description" content="Preview, share, and embed the latest articles from your favorite RSS feeds.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://feedit.madebydanny.uk/">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple animation for feed items appearing */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .feed-item {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

    <div class="container mx-auto max-w-4xl px-4 py-8">
        <div id="mainContainer" class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 sm:p-8">
            <div id="headerContent">
                <h1 class="text-3xl sm:text-4xl font-bold mb-2 text-center text-gray-800 dark:text-white">Feedit</h1>
                <p class="text-center text-gray-600 dark:text-gray-300 mb-8">Enter an RSS feed URL or select a website from below to display the latest articles.</p>
                <!-- Input form for the RSS feed URL -->
                <div class="flex flex-col sm:flex-row gap-3 mb-8">
                    <input type="url" id="rssUrl" class="flex-grow w-full px-4 py-2.5 text-gray-700 bg-gray-100 dark:bg-gray-700 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition" placeholder="e.g., https://rss.nytimes.com/services/xml/rss/nyt/World.xml" aria-label="RSS Feed URL">
                    <button id="fetchFeed" class="w-full sm:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2.5 px-8 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Fetch Feed
                    </button>
                </div>
                <!-- Embed this feed button -->
                <div class="flex justify-center mb-4">
                    <button id="embedCurrentBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg transition mr-2">
                        Embed This Feed
                    </button>
                    <span id="embedNotif" class="hidden px-2 py-1 bg-green-200 text-green-800 rounded text-xs font-semibold shadow self-center"></span>
                </div>
                <!-- Responsive button container -->
                <div class="flex flex-wrap gap-2 justify-center mb-4 overflow-x-auto" id="feedButtonsContainer">
                    <div class="flex items-center gap-1">
                        <a href="/index.html?feed=http://rss.beehiiv.com/feeds/OhvCIep1j1.xml" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2.5 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">MBD News</a>
                    </div>
                    <div class="flex items-center gap-1">
                        <a href="/index.html?feed=https://feeds.macrumors.com/MacRumors-All" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2.5 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">MacRumors</a>
                    </div>
                    <div class="flex items-center gap-1">
                        <a href="/index.html?feed=https://www.theverge.com/rss/index.xml" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2.5 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">The Verge</a>
                    </div>
                    <div class="flex items-center gap-1">
                        <a href="/index.html?feed=https://9to5mac.com/feed/" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2.5 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">9to5Mac</a>
                    </div>
                    <div class="flex items-center gap-1">
                        <a href="/index.html?feed=https://9to5google.com/feed/" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2.5 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">9to5Google</a>
                    </div>
                    <div class="flex items-center gap-1">
                        <a href="/index.html?feed=https://www.engadget.com/rss.xml" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2.5 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Engadget</a>
                    </div>
                    <div class="flex items-center gap-1">
                        <a href="/index.html?feed=https://www.cnet.com/rss/all/" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2.5 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">CNET</a>
                    </div>
                    <div class="flex items-center gap-1">
                        <a href="/index.html?feed=https://techcrunch.com/feed/" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2.5 px-6 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Techcrunch</a>
                    </div>
                    <!-- ...add more buttons here as needed... -->
                </div>
            </div>
            <!-- Container for loading indicator and error messages -->
            <div id="statusContainer" class="text-center my-4"></div>
            <!-- Container for the main feed title -->
            <div id="feedInfoContainer" class="mb-6"></div>
            <!-- Container where the feed items will be displayed -->
            <div id="feedContainer" class="space-y-6"></div>
            <!-- "Load More" button container -->
            <div id="loadMoreContainer" class="text-center mt-8">
                <button id="loadMoreBtn" class="hidden bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-bold py-2 px-6 rounded-lg transition">
                    Load More
                </button>
            </div>
            <p>&copy 2024-25 Made by Danny, By Daniel Morrisey</p>
        </div>
    </div>

    <script>
        // --- DOM Element References ---
        const fetchButton = document.getElementById('fetchFeed');
        const rssUrlInput = document.getElementById('rssUrl');
        const feedContainer = document.getElementById('feedContainer');
        const statusContainer = document.getElementById('statusContainer');
        const feedInfoContainer = document.getElementById('feedInfoContainer');
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        const mainContainer = document.getElementById('mainContainer');
        const headerContent = document.getElementById('headerContent');

        // --- State Management ---
        const LAST_URL_KEY = 'lastRssUrl';
        const ITEMS_PER_PAGE = 10; // Set a default value for items per page
        let allFeedItems = [];
        let itemsDisplayed = 0;
        let currentLayout = 'card'; // Default layout

        // --- Page Load Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const feedUrlFromParam = urlParams.get('feed');
            const layoutFromParam = urlParams.get('layout');

            // Set layout from URL param, or use default
            if (['card', 'list', 'image-top'].includes(layoutFromParam)) {
                currentLayout = layoutFromParam;
            }
            
            // If a layout is specified, we can assume it's an embed and hide some UI
            if (layoutFromParam) {
                headerContent.classList.add('hidden');
                mainContainer.classList.remove('p-6', 'sm:p-8', 'shadow-lg');
                mainContainer.classList.add('p-0');
            }

            if (feedUrlFromParam) {
                // Validate URL from parameter
                try {
                    new URL(feedUrlFromParam); // Throws error if not a valid URL
                    rssUrlInput.value = decodeURIComponent(feedUrlFromParam);
                    statusContainer.innerHTML = '<p class="text-indigo-500">Loading feed from URL parameter...</p>';
                    getRssFeed();
                } catch (e) {
                    displayError("Invalid RSS feed URL provided in the URL parameter.");
                }
            } else {
                const lastUrl = localStorage.getItem(LAST_URL_KEY);
                if (lastUrl) {
                    rssUrlInput.value = lastUrl;
                }
            }
        });

        // --- Event Listeners ---
        fetchButton.addEventListener('click', getRssFeed);
        loadMoreBtn.addEventListener('click', appendItems);
        rssUrlInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') getRssFeed();
        });

        document.getElementById('embedCurrentBtn').addEventListener('click', function() {
            const rssUrl = document.getElementById('rssUrl').value.trim();
            if (!rssUrl) return;
            const embedCode = `<iframe src="/embed.html?feed=${encodeURIComponent(rssUrl)}" style="width:100%;min-width:320px;height:600px;border:none;"></iframe>`;
            navigator.clipboard.writeText(embedCode).then(() => {
                const notif = document.getElementById('embedNotif');
                notif.textContent = "Embed code copied!";
                notif.classList.remove('hidden');
                setTimeout(() => notif.classList.add('hidden'), 1500);
            });
        });

        /**
         * Fetches and initiates the display of the RSS feed.
         */
        async function getRssFeed() {
            const rssUrl = rssUrlInput.value.trim();
            if (!rssUrl) {
                displayError("Please enter an RSS feed URL.");
                return;
            }

            // Reset state
            feedContainer.innerHTML = '';
            feedInfoContainer.innerHTML = '';
            allFeedItems = [];
            itemsDisplayed = 0;
            loadMoreBtn.classList.add('hidden');
            statusContainer.innerHTML = '<p class="text-indigo-500">Fetching and parsing feed...</p>';

            const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error(`Network response was not ok (status: ${response.status})`);
                
                const data = await response.json();
                if (data.status !== 'ok') throw new Error(data.message || 'The API could not process the feed.');
                
                localStorage.setItem(LAST_URL_KEY, rssUrl);
                statusContainer.innerHTML = ''; 
                
                displayFeedInfo(data.feed);
                allFeedItems = data.items;
                appendItems();

            } catch (error) {
                console.error("Fetching error:", error);
                displayError(`Failed to fetch feed. Check the URL or try another. <br><small>${error.message}</small>`);
            }
        }

        /**
         * Appends the next batch of items to the feed container, using the selected layout.
         */
        function appendItems() {
            const itemsToAppend = allFeedItems.slice(itemsDisplayed, itemsDisplayed + ITEMS_PER_PAGE);

            if (!itemsToAppend.length && itemsDisplayed === 0) {
                 displayError("This feed appears to be empty.");
                 return;
            }

            itemsToAppend.forEach(item => {
                const article = document.createElement('article');
                const imageUrl = extractImageUrl(item);
                const title = item.title || 'No Title';
                const link = item.link || '#';
                const pubDate = item.pubDate ? new Date(item.pubDate).toLocaleString() : 'No Date';
                const author = item.author || 'Unknown Author';

                let articleHtml;

                // --- Layout Switching ---
                switch (currentLayout) {
                    case 'list':
                        article.className = 'feed-item bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden flex flex-row items-center transform transition-all duration-300 hover:shadow-xl hover:-translate-y-1';
                        articleHtml = `
                            <div class="w-20 h-20 md:w-24 md:h-24 flex-shrink-0">
                                <img src="${imageUrl}" alt="Thumbnail for article titled ${title}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/200x200/E2E8F0/4A5568?text=N/A';">
                            </div>
                            <div class="p-4 flex-grow">
                                <h3 class="text-lg font-bold">
                                    <a href="${link}" target="_blank" rel="noopener noreferrer" class="text-indigo-600 dark:text-indigo-400 hover:underline">${title}</a>
                                </h3>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">${author} &bull; ${pubDate}</p>
                            </div>
                        `;
                        break;
                    case 'image-top':
                         article.className = 'feed-item bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden flex flex-col transform transition-all duration-300 hover:shadow-xl hover:-translate-y-1';
                         articleHtml = `
                            <div class="w-full h-48 flex-shrink-0">
                                <img src="${imageUrl}" alt="Cover image for ${title}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/E2E8F0/4A5568?text=Image+Error';">
                            </div>
                            <div class="p-5 flex flex-col justify-between flex-grow">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">${author} &bull; ${pubDate}</p>
                                    <h3 class="text-xl font-bold mb-3">
                                        <a href="${link}" target="_blank" rel="noopener noreferrer" class="text-indigo-600 dark:text-indigo-400 hover:underline">${title}</a>
                                    </h3>
                                </div>
                                <a href="https://raindrop.madebydanny.uk/?add=1&link=${link}&title=${title}" target="_blank" rel="noopener noreferrer" class="text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:underline self-start mt-2">Save for Later</a>
                                <a href="${link}" target="_blank" rel="noopener noreferrer" class="text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:underline self-start mt-2">Read More &rarr;</a>
                            </div>
                         `;
                         break;
                    case 'card':
                    default:
                        article.className = 'feed-item bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden flex flex-col md:flex-row transform transition-all duration-300 hover:shadow-xl hover:-translate-y-1';
                        articleHtml = `
                            <div class="md:w-1/3 w-full h-48 md:h-auto flex-shrink-0">
                                <img src="${imageUrl}" alt="Cover image for ${title}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/E2E8F0/4A5568?text=Image+Error';">
                            </div>
                            <div class="p-5 flex flex-col justify-between flex-grow">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">${author} &bull; ${pubDate}</p>
                                    <h3 class="text-xl font-bold mb-3">
                                        <a href="${link}" target="_blank" rel="noopener noreferrer" class="text-indigo-600 dark:text-indigo-400 hover:underline">${title}</a>
                                    </h3>
                                </div>
                                <a href="https://raindrop.madebydanny.uk/?add=1&link=${link}&title=${title}" target="_blank" rel="noopener noreferrer" class="text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:underline self-start mt-2">Save for Later</a>
                                <a href="${link}" target="_blank" rel="noopener noreferrer" class="text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:underline self-start mt-2">Read More &rarr;</a>
                            </div>
                        `;
                        break;
                }

                article.innerHTML = articleHtml;
                feedContainer.appendChild(article);
            });

            itemsDisplayed += itemsToAppend.length;

            if (itemsDisplayed < allFeedItems.length) {
                loadMoreBtn.classList.remove('hidden');
            } else {
                loadMoreBtn.classList.add('hidden');
            }
        }
        
        function displayFeedInfo(feed) {
             feedInfoContainer.innerHTML = `
                <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-100 border-b-2 border-indigo-500 pb-2 mb-4">
                    <a href="${feed.link}" target="_blank" rel="noopener noreferrer" class="hover:underline">${feed.title}</a>
                </h2>
            `;
        }

        function extractImageUrl(item) {
            if (item.thumbnail && typeof item.thumbnail === 'string' && item.thumbnail.length > 0) return item.thumbnail;
            if (item.enclosure && item.enclosure.type && item.enclosure.type.startsWith('image')) return item.enclosure.link;
            if (item.description) {
                const match = item.description.match(/<img[^>]+src="([^">]+)"/);
                if (match && match[1]) return match[1];
            }
            return `https://placehold.co/600x400/E2E8F0/4A5568?text=No+Image`;
        }

        function displayError(message) {
            statusContainer.innerHTML = `<div class="bg-red-100 dark:bg-red-900 border-l-4 border-red-500 text-red-700 dark:text-red-200 p-4 rounded-md" role="alert"><p class="font-bold">Error</p><p>${message}</p></div>`;
        }

        // --- Embed Button Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            // Add embed button event listeners
            document.querySelectorAll('.embed-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const feedUrl = btn.getAttribute('data-feed');
                    const embedCode = `<iframe src="${window.location.origin}/index.html?feed=${encodeURIComponent(feedUrl)}&layout=card" style="width:100%;min-width:320px;height:600px;border:none;"></iframe>`;
                    navigator.clipboard.writeText(embedCode).then(() => {
                        showEmbedNotification(btn, "Embed code copied!");
                    });
                });
            });
        });

        // Show a temporary notification near the button
        function showEmbedNotification(btn, message) {
            const notif = document.createElement('span');
            notif.textContent = message;
            notif.className = "ml-2 px-2 py-1 bg-green-200 text-green-800 rounded text-xs font-semibold shadow";
            btn.parentNode.appendChild(notif);
            setTimeout(() => notif.remove(), 1500);
        }

    </script>
</body>
</html>