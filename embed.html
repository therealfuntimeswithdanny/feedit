<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feedit Embed</title>
    <meta name="description" content="Embed a live RSS feed widget on your website with Feedit. Clean, responsive, and easy to use.">
    <link rel="canonical" href="https://feedit.madebydanny.uk/embed.html">
    <link rel="icon" href="https://public-danielmorrisey-com.danielmorrisey.com/logo1.png" type="image/x-icon">
    <!-- Open Graph -->
    <meta property="og:title" content="Feedit Embed - Live RSS Feed Widget">
    <meta property="og:description" content="Embed a live RSS feed widget on your website with Feedit. Clean, responsive, and easy to use.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://feedit.madebydanny.uk/embed.html">
    <meta property="og:image" content="https://public-danielmorrisey-com.danielmorrisey.com/Screenshot%202025-08-06%20at%2010.30.14.png">
    <meta property="og:site_name" content="Feedit">
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Feedit Embed - Live RSS Feed Widget">
    <meta name="twitter:description" content="Embed a live RSS feed widget on your website with Feedit. Clean, responsive, and easy to use.">
    <meta name="twitter:image" content="https://public-danielmorrisey-com.danielmorrisey.com/Screenshot%202025-08-06%20at%2010.30.14.png">
    <meta name="twitter:site" content="@danielmorrisey">
    <meta name="twitter:creator" content="@danielmorrisey">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background: transparent; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .feed-item { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <div class="max-w-2xl mx-auto px-2 py-4">
        <div id="statusContainer" class="text-center my-2"></div>
        <div id="feedInfoContainer" class="mb-4"></div>
        <div id="feedContainer" class="space-y-4"></div>
        <div id="loadMoreContainer" class="text-center mt-4">
            <button id="loadMoreBtn" class="hidden bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 font-bold py-2 px-6 rounded-lg transition">
                Load More
            </button>
        </div>
    </div>
    <script>
        // --- DOM Elements ---
        const feedContainer = document.getElementById('feedContainer');
        const statusContainer = document.getElementById('statusContainer');
        const feedInfoContainer = document.getElementById('feedInfoContainer');
        const loadMoreBtn = document.getElementById('loadMoreBtn');

        // --- State ---
        const ITEMS_PER_PAGE = 10;
        let allFeedItems = [];
        let itemsDisplayed = 0;

        // --- Get feed param and fetch ---
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const feedUrl = urlParams.get('feed');
            if (!feedUrl) {
                displayError("No feed URL provided.");
                return;
            }
            // Always fetch fresh from RSS server on reload
            getRssFeed(feedUrl);
        });

        async function getRssFeed(rssUrl) {
            feedContainer.innerHTML = '';
            feedInfoContainer.innerHTML = '';
            allFeedItems = [];
            itemsDisplayed = 0;
            loadMoreBtn.classList.add('hidden');
            statusContainer.innerHTML = '<p class="text-indigo-500">Fetching and parsing feed...</p>';

            const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error(`Network response was not ok (status: ${response.status})`);
                const data = await response.json();
                if (data.status !== 'ok') throw new Error(data.message || 'The API could not process the feed.');
                statusContainer.innerHTML = '';
                displayFeedInfo(data.feed);
                allFeedItems = data.items;
                appendItems();
            } catch (error) {
                displayError(`Failed to fetch feed.<br><small>${error.message}</small>`);
            }
        }

        function appendItems() {
            const itemsToAppend = allFeedItems.slice(itemsDisplayed, itemsDisplayed + ITEMS_PER_PAGE);
            if (!itemsToAppend.length && itemsDisplayed === 0) {
                displayError("This feed appears to be empty.");
                return;
            }
            itemsToAppend.forEach(item => {
                const article = document.createElement('article');
                const imageUrl = extractImageUrl(item);
                const title = item.title || 'No Title';
                const link = item.link || '#';
                const pubDate = item.pubDate ? new Date(item.pubDate).toLocaleDateString() : '';
                const author = item.author || '';
                article.className = 'feed-item bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden flex flex-col md:flex-row transition-all duration-300';
                article.innerHTML = `
                    <div class="md:w-1/3 w-full h-36 md:h-auto flex-shrink-0">
                        <img src="${imageUrl}" alt="Cover image for ${title}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/E2E8F0/4A5568?text=No+Image';">
                    </div>
                    <div class="p-4 flex flex-col justify-between flex-grow">
                        <div>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">${author ? author + ' &bull; ' : ''}${pubDate}</p>
                            <h3 class="text-lg font-bold mb-2">
                                <a href="${link}" target="_blank" rel="noopener noreferrer" class="text-indigo-600 dark:text-indigo-400 hover:underline">${title}</a>
                            </h3>
                        </div>
                        <a href="${link}" target="_blank" rel="noopener noreferrer" class="text-sm font-semibold text-indigo-600 dark:text-indigo-400 hover:underline self-start mt-2">Read More &rarr;</a>
                    </div>
                `;
                feedContainer.appendChild(article);
            });
            itemsDisplayed += itemsToAppend.length;
            if (itemsDisplayed < allFeedItems.length) {
                loadMoreBtn.classList.remove('hidden');
            } else {
                loadMoreBtn.classList.add('hidden');
            }
        }

        loadMoreBtn.addEventListener('click', appendItems);

        function displayFeedInfo(feed) {
            feedInfoContainer.innerHTML = `
                <h2 class="text-xl font-bold text-gray-800 dark:text-gray-100 border-b-2 border-indigo-500 pb-1 mb-2">
                    <a href="${feed.link}" target="_blank" rel="noopener noreferrer" class="hover:underline">${feed.title}</a>
                </h2>
            `;
        }

        function extractImageUrl(item) {
            if (item.thumbnail && typeof item.thumbnail === 'string' && item.thumbnail.length > 0) return item.thumbnail;
            if (item.enclosure && item.enclosure.type && item.enclosure.type.startsWith('image')) return item.enclosure.link;
            if (item.description) {
                const match = item.description.match(/<img[^>]+src="([^">]+)"/);
                if (match && match[1]) return match[1];
            }
            return `https://placehold.co/600x400/E2E8F0/4A5568?text=No+Image`;
        }

        function displayError(message) {
            statusContainer.innerHTML = `<div class="bg-red-100 dark:bg-red-900 border-l-4 border-red-500 text-red-700 dark:text-red-200 p-3 rounded-md" role="alert"><p class="font-bold">Error</p><p>${message}</p></div>`;
        }
    </script>
</body>
</html>
